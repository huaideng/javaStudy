<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跳棋游戏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        
        .game-container {
            text-align: center;
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            gap: 0;
            border: 2px solid #333;
            background-color: #d2b48c;
            margin: 20px auto;
        }
        
        .square {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .dark {
            background-color: #8b4513;
        }
        
        .light {
            background-color: #f5f5dc;
        }
        
        .piece {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .player1 {
            background-color: #ff6666;
            border: 2px solid #cc3333;
        }
        
        .player2 {
            background-color: #6666ff;
            border: 2px solid #3333cc;
        }
        
        .king::after {
            content: "♔";
            color: gold;
            font-size: 20px;
        }
        
        .selected {
            box-shadow: 0 0 0 3px yellow;
        }
        
        .valid-move {
            position: relative;
        }
        
        .valid-move::before {
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: rgba(0, 255, 0, 0.5);
            border-radius: 50%;
        }
        
        .game-info {
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
        }
        
        .restart-btn {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .restart-btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>跳棋游戏</h1>
        <div class="game-info">当前玩家: <span id="current-player">玩家1</span></div>
        <div class="board" id="board"></div>
        <button class="restart-btn" onclick="restartGame()">重新开始</button>
    </div>

    <script>
        // 游戏状态
        const board = [];
        let currentPlayer = 1;
        let selectedPiece = null;
        let gameMode = "regular"; // regular or king
        
        // 初始化棋盘
        function initializeBoard() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            
            // 创建空棋盘
            for (let row = 0; row < 8; row++) {
                board[row] = [];
                for (let col = 0; col < 8; col++) {
                    // 只有深色格子才能放棋子
                    const isDarkSquare = (row + col) % 2 === 1;
                    const square = document.createElement('div');
                    square.className = `square ${(isDarkSquare ? 'dark' : 'light')}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    
                    if (isDarkSquare) {
                        // 放置初始棋子
                        if (row < 3) { // 玩家2的棋子
                            board[row][col] = 2;
                            const piece = document.createElement('div');
                            piece.className = 'piece player2';
                            piece.dataset.player = '2';
                            piece.dataset.row = row;
                            piece.dataset.col = col;
                            piece.textContent = '';
                            square.appendChild(piece);
                        } else if (row > 4) { // 玩家1的棋子
                            board[row][col] = 1;
                            const piece = document.createElement('div');
                            piece.className = 'piece player1';
                            piece.dataset.player = '1';
                            piece.dataset.row = row;
                            piece.dataset.col = col;
                            piece.textContent = '';
                            square.appendChild(piece);
                        } else {
                            board[row][col] = 0; // 空位置
                        }
                    } else {
                        board[row][col] = -1; // 浅色格子，不可放置棋子
                    }
                    
                    square.addEventListener('click', handleSquareClick);
                    boardElement.appendChild(square);
                }
            }
        }
        
        // 处理方格点击事件
        function handleSquareClick(event) {
            const row = parseInt(event.target.dataset.row);
            const col = parseInt(event.target.dataset.col);
            
            // 如果点击的是棋子
            if (event.target.classList.contains('piece')) {
                const player = parseInt(event.target.dataset.player);
                
                // 选择己方棋子
                if (player === currentPlayer) {
                    // 清除之前的选择
                    clearSelections();
                    
                    // 高亮选中的棋子
                    event.target.classList.add('selected');
                    selectedPiece = {row, col};
                }
            } 
            // 如果点击的是空方格
            else {
                // 如果有选中的棋子，并且点击的是有效位置
                if (selectedPiece && isValidMove(selectedPiece.row, selectedPiece.col, row, col)) {
                    movePiece(selectedPiece.row, selectedPiece.col, row, col);
                    clearSelections();
                    switchPlayer();
                }
            }
        }
        
        // 检查移动是否有效
        function isValidMove(fromRow, fromCol, toRow, toCol) {
            // 检查目标位置是否在棋盘内
            if (toRow < 0 || toRow > 7 || toCol < 0 || toCol > 7) {
                return false;
            }
            
            // 检查目标位置是否为空
            if (board[toRow][toCol] !== 0) {
                return false;
            }
            
            // 检查是否是相邻的对角线移动
            const rowDiff = Math.abs(toRow - fromRow);
            const colDiff = Math.abs(toCol - fromCol);
            
            if (rowDiff === 1 && colDiff === 1) {
                // 普通棋子只能向前移动（对于玩家1是向下，对于玩家2是向上）
                if (board[fromRow][fromCol] === 1) {
                    return toRow > fromRow; // 玩家1只能向下
                } else if (board[fromRow][fromCol] === 2) {
                    return toRow < fromRow; // 玩家2只能向上
                }
            } 
            // 检查跳跃移动
            else if (rowDiff === 2 && colDiff === 2) {
                // 计算被跳过的棋子位置
                const middleRow = (fromRow + toRow) / 2;
                const middleCol = (fromCol + toCol) / 2;
                
                // 检查被跳过的是否是对方棋子
                if (board[middleRow][middleCol] !== 0 && 
                    board[middleRow][middleCol] !== currentPlayer) {
                    // 普通棋子跳跃规则
                    if (board[fromRow][fromCol] === 1) {
                        return toRow > fromRow; // 玩家1只能向下跳跃
                    } else if (board[fromRow][fromCol] === 2) {
                        return toRow < fromRow; // 玩家2只能向上跳跃
                    }
                }
            }
            
            return false;
        }
        
        // 移动棋子
        function movePiece(fromRow, fromCol, toRow, toCol) {
            // 移动棋子
            board[toRow][toCol] = board[fromRow][fromCol];
            board[fromRow][fromCol] = 0;
            
            // 获取棋子DOM元素并移动
            const squares = document.querySelectorAll('.square');
            let fromSquare = null;
            let toSquare = null;
            
            for (let i = 0; i < squares.length; i++) {
                if (parseInt(squares[i].dataset.row) === fromRow && 
                    parseInt(squares[i].dataset.col) === fromCol) {
                    fromSquare = squares[i];
                }
                if (parseInt(squares[i].dataset.row) === toRow && 
                    parseInt(squares[i].dataset.col) === toCol) {
                    toSquare = squares[i];
                }
            }
            
            if (fromSquare && toSquare) {
                const piece = fromSquare.querySelector('.piece');
                if (piece) {
                    fromSquare.removeChild(piece);
                    toSquare.appendChild(piece);
                    
                    // 更新数据属性
                    piece.dataset.row = toRow;
                    piece.dataset.col = toCol;
                }
            }
            
            // 检查是否发生了跳跃，如果是则移除被跳过的棋子
            const rowDiff = Math.abs(toRow - fromRow);
            if (rowDiff === 2) {
                const middleRow = (fromRow + toRow) / 2;
                const middleCol = (fromCol + toCol) / 2;
                
                // 从棋盘数组中移除被跳过的棋子
                board[middleRow][middleCol] = 0;
                
                // 从DOM中移除被跳过的棋子
                const squares = document.querySelectorAll('.square');
                for (let i = 0; i < squares.length; i++) {
                    if (parseInt(squares[i].dataset.row) === middleRow && 
                        parseInt(squares[i].dataset.col) === middleCol) {
                        const capturedPiece = squares[i].querySelector('.piece');
                        if (capturedPiece) {
                            squares[i].removeChild(capturedPiece);
                        }
                        break;
                    }
                }
            }
            
            // 检查棋子是否到达对方底线，如果是则升级为王
            if ((board[toRow][toCol] === 1 && toRow === 7) || 
                (board[toRow][toCol] === 2 && toRow === 0)) {
                // 添加王的标记
                const piece = toSquare.querySelector('.piece');
                if (piece) {
                    piece.classList.add('king');
                    piece.textContent = '';
                }
            }
        }
        
        // 清除所有选择高亮
        function clearSelections() {
            const pieces = document.querySelectorAll('.piece');
            pieces.forEach(piece => piece.classList.remove('selected'));
        }
        
        // 切换玩家
        function switchPlayer() {
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            document.getElementById('current-player').textContent = 
                currentPlayer === 1 ? '玩家1' : '玩家2';
        }
        
        // 重新开始游戏
        function restartGame() {
            currentPlayer = 1;
            document.getElementById('current-player').textContent = '玩家1';
            initializeBoard();
        }
        
        // 初始化游戏
        initializeBoard();
    </script>
</body>
</html>